<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>í€´ì¦ˆ ì‹œìŠ¤í…œ</title>
<style>
body { font-family: Arial; margin: 20px; }
h1 { margin-bottom: 10px; }

select, button { padding: 8px; margin-right: 10px; }

#questionArea { margin-top: 20px; padding: 10px; border-radius: 8px; }
.question-card {
    border: 1px solid #ccc;
    padding: 10px;
    margin-bottom: 5px;
    cursor: pointer;
    border-radius: 6px;
}
.question-card:hover { background: #f0f0f0; }

#answerBox {
    margin-top: 20px;
    padding: 10px;
    border: 1px solid #444;
    background: #fafafa;
}

.correct { color: green; font-weight: bold; }
.wrong { color: red; font-weight: bold; }

.menuBar { margin-bottom: 20px; }

#resetBtn {
    background: red;
    color: white;
    padding: 8px 14px;
    border-radius: 6px;
    margin-left: 10px;
}

#miniModeLabel {
    font-weight: bold;
    color: #444;
    margin-left: 5px;
}
</style>
</head>
<body>

<h1>í€´ì¦ˆ ì‹œìŠ¤í…œ</h1>

<div class="menuBar">
    <button id="miniTestBtn">ğŸ”¥ Mini Test (ê³¼ëª©ë³„ 10ë¬¸ì œ)</button>
    <button id="resetBtn">ë¦¬ì…‹</button>
</div>

<div id="miniModeLabel"></div>

<select id="subjectSelect">
    <option value="">ê³¼ëª© ì„ íƒ</option>
</select>

<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>í€´ì¦ˆ ì‹œìŠ¤í…œ</title>

<style>
body { font-family: Arial; margin: 20px; }
h1 { margin-bottom: 10px; }
select, button { padding: 8px; margin: 7px 5px; }
#questionArea { margin-top: 20px; padding:10px; border-radius:8px; }
.question-card { 
    border: 1px solid #ccc; 
    padding: 10px; 
    margin-bottom: 5px; 
    cursor: pointer; 
    border-radius: 6px;
}
.question-card:hover { background: #f0f0f0; }
.correct { color: green; font-weight: bold; }
.wrong { color: red; font-weight: bold; }

#answerBox { 
    margin-top: 20px; 
    padding: 10px; 
    border: 1px solid #444; 
    background: #fafafa; 
    border-radius:8px;
}

#progressText { margin-top:15px; font-weight:bold; }

#miniModeLabel { color:#d9534f; font-weight:bold; font-size:18px; }

</style>
</head>
<body>

<h1>í€´ì¦ˆ ì‹œìŠ¤í…œ</h1>

<!-- ğŸŸ¦ ê³¼ëª© ì„ íƒ ì¶”ê°€ë¨ (ì´ê²Œ ì—†ì–´ì„œ ê³¼ëª©ì´ ì•ˆ ë–´ë˜ ê²ƒ) -->
<select id="subjectSelect">
    <option value="">ê³¼ëª© ì„ íƒ</option>
</select>

<select id="themeSelect">
    <option value="">í…Œë§ˆ ì„ íƒ</option>
</select>

<button id="nextBtn">ë‹¤ìŒ ë¬¸ì œ</button>
<button id="miniTestBtn">Mini Test</button>
<button id="resetBtn" style="background:#e66;color:#fff">ë¦¬ì…‹</button>

<p id="miniModeLabel"></p>
<p id="progressText"></p>

<div id="questionArea"></div>
<div id="answerBox"></div>


<script>
const jsonURL = "https://kangroo1209-alt.github.io/quizquiz/output.json";

let quizData = [];
let currentSubject = "";
let currentTheme = "";
let currentQuestion = null;
let usedQuestions = new Set();

let miniMode = false;
let miniList = [];
let miniIndex = 0;
let miniWrong = [];

fetch(jsonURL)
.then(res => res.json())
.then(data => {

    // BOM / ì•ë’¤ ê³µë°± ì œê±°
    quizData = data.map(q => ({
        ...q,
        subject: (q.subject || "").replace(/^\uFEFF/,"").trim(),
        theme:   (q.theme   || "").replace(/^\uFEFF/,"").trim(),
        question:(q.question|| "").trim(),
        answer:  (q.answer  || "").trim(),
    }));

    renderSubjects();
});


const subjectSelect = document.getElementById("subjectSelect");
const themeSelect   = document.getElementById("themeSelect");
const questionArea  = document.getElementById("questionArea");
const answerBox     = document.getElementById("answerBox");
const nextBtn       = document.getElementById("nextBtn");
const miniTestBtn   = document.getElementById("miniTestBtn");
const resetBtn      = document.getElementById("resetBtn");
const progressText  = document.getElementById("progressText");
const miniModeLabel = document.getElementById("miniModeLabel");


// =============================
// ğŸŸ¦ ê³¼ëª© / í…Œë§ˆ ë¡œë”©
// =============================
function renderSubjects() {
    const subjects = [...new Set(quizData.map(q => q.subject))];

    subjectSelect.innerHTML =
        '<option value="">ê³¼ëª© ì„ íƒ</option>' +
        subjects.map(s => `<option value="${s}">${s}</option>`).join("");

    // ì´ˆê¸° ë¬¸ì œ ì˜ì—­ ë¦¬ì…‹
    questionArea.innerHTML = "<p>ê³¼ëª©ì„ ì„ íƒí•˜ì„¸ìš”.</p>";
}

subjectSelect.addEventListener("change", () => {
    currentSubject = subjectSelect.value;
    currentTheme = "";
    usedQuestions.clear();
    miniMode = false;
    miniModeLabel.innerHTML = "";
    answerBox.innerHTML = "";
    progressText.innerHTML = "";
    renderThemes();
});


function renderThemes() {
    const themes = [
        ...new Set(
            quizData
                .filter(q => q.subject === currentSubject)
                .map(q => q.theme)
        )
    ];

    themeSelect.innerHTML =
        '<option value="">í…Œë§ˆ ì„ íƒ</option>' +
        themes.map(t => `<option value="${t}">${t}</option>`).join("");
}

themeSelect.addEventListener("change", () => {
    currentTheme = themeSelect.value;
    usedQuestions.clear();
    miniMode = false;
    miniModeLabel.innerHTML = "";
    renderQuestion();
});


// =============================
// ğŸŸ¦ ë¬¸ì œ ì œì‹œ
// =============================
function renderQuestion() {
    if (!currentSubject || !currentTheme) {
        questionArea.innerHTML = "<p>ê³¼ëª©ê³¼ í…Œë§ˆë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>";
        return;
    }

    const filtered = quizData.filter(
        q => q.subject === currentSubject && q.theme === currentTheme
    );

    const candidates = filtered.filter(q => !usedQuestions.has(q.question));

    if (candidates.length === 0) {
        questionArea.innerHTML = "<p>ëª¨ë“  ë¬¸ì œë¥¼ ë‹¤ í’€ì—ˆìŠµë‹ˆë‹¤.</p>";
        return;
    }

    const q = candidates[Math.floor(Math.random() * candidates.length)];
    currentQuestion = q;
    usedQuestions.add(q.question);

    updateProgress(filtered.length);
    renderQuestionCard(q);
}


// ğŸ” ì—¬ëŸ¬ ì •ë‹µ ìˆëŠ” ë¬¸ì œ ì²˜ë¦¬ (ë™ì¼ questionì´ë©´ ëª¨ë‘ ì •ë‹µ)
function getCorrectAnswers(questionText) {
    return [...new Set(
        quizData.filter(q => q.question === questionText).map(q => q.answer)
    )];
}


// =============================
// ğŸŸ¦ ë¬¸ì œ ì¹´ë“œ ìƒì„±
// =============================
function renderQuestionCard(q) {
    const correctAnswers = getCorrectAnswers(q.question);
    const mainAnswer = correctAnswers[0];

    // ê³„ì‚° í…Œë§ˆ â†’ ì£¼ê´€ì‹
    if (currentTheme === "ê³„ì‚°") {
        questionArea.style.background = "#fff6d1";
        questionArea.innerHTML = `
            <div class="question-card"><b>ë¬¸ì œ:</b> ${q.question}</div>
            <input id="shortAnswer" type="text" placeholder="ì •ë‹µ ì…ë ¥" 
                style="padding:8px;margin-top:10px;width:200px;">
            <button onclick="checkShortAnswer()" style="padding:8px 14px;margin-left:10px;">
                í™•ì¸
            </button>
        `;
        answerBox.innerHTML = "";
        return;
    }

    // ê°ê´€ì‹ ë³´ê¸° ìƒì„±
    let answers = [mainAnswer];

    const sameTheme = quizData.filter(
        item => item.subject === currentSubject && item.theme === currentTheme
    );

    let otherAnswers = sameTheme
        .map(item => item.answer)
        .filter(a => !correctAnswers.includes(a));

    // 5ê°œê¹Œì§€ ë³´ê¸° ì±„ìš°ê¸°
    while (answers.length < 5 && otherAnswers.length > 0) {
        const idx = Math.floor(Math.random() * otherAnswers.length);
        answers.push(otherAnswers[idx]);
        otherAnswers.splice(idx, 1);
    }

    // ë¶€ì¡±í•˜ë©´ "ë³´ê¸° ì—†ìŒ" ì±„ìš°ê¸°
    while (answers.length < 5)
        answers.push("ë³´ê¸° ì—†ìŒ");

    answers = answers.sort(() => Math.random() - 0.5);

    questionArea.style.background = "white";
    questionArea.innerHTML = `<div class="question-card"><b>ë¬¸ì œ:</b> ${q.question}</div>`;

    answers.forEach((ans, i) => {
        questionArea.innerHTML += `
            <div class="question-card" onclick="checkAnswer('${ans.replace(/'/g,"&#39;")}')">
                ${i+1}. ${ans}
            </div>`;
    });

    answerBox.innerHTML = "";
}



// =============================
// ğŸŸ¦ ê°ê´€ì‹ ì •ë‹µ ì²´í¬
// =============================
window.checkAnswer = (ans) => {
    const correctAnswers = getCorrectAnswers(currentQuestion.question);
    const mainAnswer = correctAnswers[0];

    if (ans === mainAnswer) {
        answerBox.innerHTML = `
            <p class="correct">ì •ë‹µì…ë‹ˆë‹¤!</p>
            <p>ì •ë‹µ ëª©ë¡: ${correctAnswers.join(", ")}</p>
        `;
    } else {
        answerBox.innerHTML = `
            <p class="wrong">ì˜¤ë‹µì…ë‹ˆë‹¤!</p>
            <p>ì •ë‹µ: ${mainAnswer}</p>
            <p>ì •ë‹µ ëª©ë¡: ${correctAnswers.join(", ")}</p>
        `;
    }

    if (miniMode) {
        if (ans !== mainAnswer) {
            miniWrong.push({
                question: currentQuestion.question,
                myAnswer: ans,
                correct: correctAnswers
            });
        }
        miniIndex++;
        setTimeout(renderMiniQuestion, 700);
    }
};



// =============================
// ğŸŸ¦ ì£¼ê´€ì‹ ì •ë‹µ ì²´í¬
// =============================
function checkShortAnswer() {
    const input = document.getElementById("shortAnswer").value.trim();
    const correct = getCorrectAnswers(currentQuestion.question)
                    .map(v => v.toString().trim());

    if (correct.includes(input)) {
        answerBox.innerHTML = `
            <p class="correct">ì •ë‹µì…ë‹ˆë‹¤!</p>
            <p>ì •ë‹µ ëª©ë¡: ${correct.join(", ")}</p>
        `;
    } else {
        answerBox.innerHTML = `
            <p class="wrong">ì˜¤ë‹µì…ë‹ˆë‹¤!</p>
            <p>ì •ë‹µë“¤: ${correct.join(", ")}</p>
        `;
    }

    if (miniMode) {
        if (!correct.includes(input)) {
            miniWrong.push({
                question: currentQuestion.question,
                myAnswer: input,
                correct
            });
        }
        miniIndex++;
        setTimeout(renderMiniQuestion, 700);
    }
}



// =============================
// ğŸŸ¦ ë‹¤ìŒ ë¬¸ì œ ë²„íŠ¼
// =============================
nextBtn.addEventListener("click", () => {
    if (!miniMode) renderQuestion();
});


// =============================
// ğŸŸ¦ ë¦¬ì…‹
// =============================
resetBtn.addEventListener("click", () => {
    usedQuestions.clear();
    miniMode = false;
    miniModeLabel.innerHTML = "";
    answerBox.innerHTML = "";
    questionArea.innerHTML = "";
    progressText.innerHTML = "";
});


// =============================
// ğŸ”¥ Mini Test
// =============================
miniTestBtn.addEventListener("click", startMiniTest);

function startMiniTest() {
    miniMode = true;
    usedQuestions.clear();
    miniWrong = [];
    miniIndex = 0;
    miniModeLabel.innerHTML = "<p>ğŸ”¥ Mini Test ì§„í–‰ì¤‘</p>";

    const subjects = [...new Set(quizData.map(q => q.subject))];
    miniList = [];

    subjects.forEach(sub => {
        const subjectQuestions = quizData.filter(q => q.subject === sub);

        let pool = [...subjectQuestions];
        let selected = [];

        while (selected.length < 10 && pool.length > 0) {
            const idx = Math.floor(Math.random() * pool.length);
            selected.push(pool[idx]);
            pool.splice(idx, 1);
        }

        miniList = miniList.concat(selected);
    });

    renderMiniQuestion();
}

function renderMiniQuestion() {
    if (miniIndex >= miniList.length) return showMiniResult();

    const q = miniList[miniIndex];
    currentQuestion = q;

    questionArea.style.background = "#fff7da";
    progressText.innerHTML = `
        Mini Test: ${miniIndex + 1} / ${miniList.length}
        <br>í˜„ì¬ ê³¼ëª©: <b>${q.subject}</b>
    `;

    renderQuestionCard(q);
}

function showMiniResult() {
    miniMode = false;
    miniModeLabel.innerHTML = "";

    let score = miniList.length - miniWrong.length;

    let html = `<h2>Mini Test ì™„ë£Œ!</h2>`;
    html += `<p>ì´ ë¬¸ì œ: ${miniList.length}</p>`;
    html += `<p>ì •ë‹µ: ${score}</p>`;
    html += `<p>ì˜¤ë‹µ: ${miniWrong.length}</p><br>`;

    if (miniWrong.length > 0) {
        html += `<h3>í‹€ë¦° ë¬¸ì œ ëª©ë¡:</h3>`;
        miniWrong.forEach(w => {
            html += `
                <div class="question-card">
                    <b>ë¬¸ì œ:</b> ${w.question}<br>
                    <b>ë‚´ ë‹µ:</b> ${w.myAnswer}<br>
                    <b>ì •ë‹µ:</b> ${w.correct.join(", ")}
                </div>
            `;
        });
    }

    questionArea.innerHTML = html;
}



// =============================
// ğŸŸ¦ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
// =============================
function updateProgress(total) {
    progressText.innerHTML = `ì§„í–‰ë¥ : ${usedQuestions.size} / ${total}`;
}

</script>
</body>
</html>



