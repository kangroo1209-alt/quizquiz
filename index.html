<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>í€´ì¦ˆ ì‹œìŠ¤í…œ</title>
<style>
body { font-family: Arial; margin: 20px; }
h1 { margin-bottom: 10px; }
select, button { padding: 8px; margin-right: 10px; }
#questionArea { margin-top: 20px; }
.question-card { border: 1px solid #ccc; padding: 10px; margin-bottom: 5px; cursor: pointer; }
.question-card:hover { background: #f0f0f0; }
#answerBox { margin-top: 20px; padding: 10px; border: 1px solid #444; background: #fafafa; }
#nextBtn { margin-top: 10px; padding: 8px 16px; }
.correct { color: green; font-weight: bold; }
.wrong { color: red; font-weight: bold; }
.menuBar { margin-bottom: 20px; }
</style>
</head>
<body>

<h1>í€´ì¦ˆ ì‹œìŠ¤í…œ</h1>

<div class="menuBar">
    <button id="miniTestBtn">ğŸ”¥ Mini Test (ê³¼ëª©ë³„ 10ë¬¸ì œ)</button>
</div>

<select id="subjectSelect">
    <option value="">ê³¼ëª© ì„ íƒ</option>
</select>

<select id="themeSelect">
    <option value="">í…Œë§ˆ ì„ íƒ</option>
</select>

<div id="questionArea"></div>
<button id="nextBtn">ë‹¤ìŒ ë¬¸ì œ</button>
<div id="answerBox"></div>

<script>
// ===== JSON ê²½ë¡œ =====
const jsonURL = "https://kangroo1209-alt.github.io/quizquiz/output.json";

// ===== ì „ì—­ ë³€ìˆ˜ =====
let quizData = [];
let currentSubject = "";
let currentTheme = "";
let currentQuestion = null;
let usedQuestions = new Set();

// Mini Test ë³€ìˆ˜
let miniMode = false;
let miniList = [];      // ì „ì²´ mini test ë¬¸ì œ ë¦¬ìŠ¤íŠ¸
let miniIndex = 0;      // í˜„ì¬ ë¬¸ì œ ë²ˆí˜¸
let miniWrong = [];     // í‹€ë¦° ë¬¸ì œ ì €ì¥

// JSON ë¡œë“œ
fetch(jsonURL)
.then(res => res.json())
.then(data => {
    quizData = data;
    renderSubjects();
})
.catch(err => {
    alert("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: " + err);
});

// HTML ìš”ì†Œë“¤
const subjectSelect = document.getElementById("subjectSelect");
const themeSelect = document.getElementById("themeSelect");
const questionArea = document.getElementById("questionArea");
const answerBox = document.getElementById("answerBox");
const nextBtn = document.getElementById("nextBtn");
const miniTestBtn = document.getElementById("miniTestBtn");

// ================================
// ê³¼ëª© ì„ íƒ
// ================================
function renderSubjects() {
    const subjects = [...new Set(quizData.map(q => q.subject))];
    subjectSelect.innerHTML =
        '<option value="">ê³¼ëª© ì„ íƒ</option>' +
        subjects.map(s => `<option value="${s}">${s}</option>`).join("");
}

subjectSelect.addEventListener("change", () => {
    currentSubject = subjectSelect.value;
    currentTheme = "";
    usedQuestions.clear();
    renderThemes();
    questionArea.innerHTML = "";
    answerBox.innerHTML = "";
});

// ================================
// í…Œë§ˆ ì„ íƒ
// ================================
function renderThemes() {
    const themes = [...new Set(
        quizData.filter(q => q.subject === currentSubject).map(q => q.theme)
    )];
    themeSelect.innerHTML =
        '<option value="">í…Œë§ˆ ì„ íƒ</option>' +
        themes.map(t => `<option value="${t}">${t}</option>`).join("");
}

themeSelect.addEventListener("change", () => {
    currentTheme = themeSelect.value;
    miniMode = false;
    usedQuestions.clear();
    renderQuestion();
    answerBox.innerHTML = "";
});

// ================================
// í•˜ë‚˜ì˜ ë¬¸ì œì— ëŒ€í•œ ëª¨ë“  ì •ë‹µ ì°¾ê¸°
// ================================
function getCorrectAnswers(questionText) {
    return [...new Set(
        quizData.filter(q => q.question === questionText).map(q => q.answer)
    )];
}

// ================================
// ë³´ê¸° 5ê°œ êµ¬ì„± (ì¤‘ë³µ ë°©ì§€)
// ================================
function buildChoices(questionObj) {
    const correctList = getCorrectAnswers(questionObj.question);
    const mainAnswer = correctList[0];

    let choices = [mainAnswer];

    const sameThemePool = quizData.filter(
        q => q.subject === questionObj.subject && q.theme === questionObj.theme
    );

    let otherAnswers = sameThemePool
        .map(q => q.answer)
        .filter(a => !correctList.includes(a));

    while (choices.length < 5 && otherAnswers.length > 0) {
        const idx = Math.floor(Math.random() * otherAnswers.length);
        choices.push(otherAnswers[idx]);
        otherAnswers.splice(idx, 1);
    }

    // ë¶€ì¡±í•˜ë©´ ì„ì˜ ë³´ì¶© (ì ˆëŒ€ ê²¹ì¹˜ì§€ ì•Šë„ë¡)
    if (choices.length < 5) {
        let backup = quizData
            .map(q => q.answer)
            .filter(a => !choices.includes(a) && !correctList.includes(a));
        while (choices.length < 5 && backup.length > 0) {
            const idx = Math.floor(Math.random() * backup.length);
            choices.push(backup[idx]);
            backup.splice(idx, 1);
        }
    }

    return choices.sort(() => Math.random() - 0.5);
}

// ================================
// ì¼ë°˜ ë¬¸ì œ ì¶œì œ
// ================================
function renderQuestion() {
    if (!currentSubject || !currentTheme) {
        questionArea.innerHTML = "<p>ê³¼ëª©ê³¼ í…Œë§ˆë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>";
        return;
    }

    const filtered = quizData.filter(
        q => q.subject === currentSubject && q.theme === currentTheme
    );

    const available = filtered.filter(q => !usedQuestions.has(q.question));

    if (available.length === 0) {
        questionArea.innerHTML = "<p>ëª¨ë“  ë¬¸ì œë¥¼ ë‹¤ í’€ì—ˆìŠµë‹ˆë‹¤.</p>";
        return;
    }

    const q = available[Math.floor(Math.random() * available.length)];
    currentQuestion = q;
    usedQuestions.add(q.question);

    displayQuestion(q);
}

// ë¬¸ì œ UI ì¶œë ¥
function displayQuestion(q) {
    const choices = buildChoices(q);
    const correctList = getCorrectAnswers(q.question);

    questionArea.innerHTML =
        `<div class="question-card"><b>ë¬¸ì œ:</b> ${q.question}</div>`;

    choices.forEach((ans, idx) => {
        questionArea.innerHTML += `
        <div class="question-card" onclick="checkAnswer('${ans.replace(/'/g, "&#39;")}')">
            ${idx + 1}. ${ans}
        </div>`;
    });

    answerBox.innerHTML = "";
}

// ì •ë‹µ ì²´í¬
window.checkAnswer = function (ans) {
    const correctList = getCorrectAnswers(currentQuestion.question);
    const mainAnswer = correctList[0];

    if (ans === mainAnswer) {
        answerBox.innerHTML =
            `<p class="correct">ì •ë‹µì…ë‹ˆë‹¤!</p>
             <p>ì´ ë¬¸ì œì˜ ë‹¤ë¥¸ ì •ë‹µë“¤: ${correctList.join(", ")}</p>`;
    } else {
        answerBox.innerHTML =
            `<p class="wrong">ì˜¤ë‹µì…ë‹ˆë‹¤!</p>
             <p>ì •ë‹µ: ${mainAnswer}</p>
             <p>ë‹¤ë¥¸ ì •ë‹µë“¤: ${correctList.join(", ")}</p>`;
    }

    if (miniMode) {
        if (ans !== mainAnswer) {
            miniWrong.push({
                question: currentQuestion.question,
                myAnswer: ans,
                correct: correctList
            });
        }
        miniIndex++;
        setTimeout(renderMiniQuestion, 800);
    }
};

nextBtn.addEventListener("click", () => {
    if (!miniMode) renderQuestion();
});

// ================================
// Mini Test ì‹œì‘
// ================================
miniTestBtn.addEventListener("click", startMiniTest);

function startMiniTest() {
    miniMode = true;
    usedQuestions.clear();
    miniWrong = [];
    miniIndex = 0;
    miniList = [];

    const subjects = [...new Set(quizData.map(q => q.subject))];

    subjects.forEach(sub => {
        const pool = quizData.filter(q => q.subject === sub);
        let pick = [];

        let temp = [...pool];
        while (pick.length < 10 && temp.length > 0) {
            const idx = Math.floor(Math.random() * temp.length);
            pick.push(temp[idx]);
            temp.splice(idx, 1);
        }

        miniList = miniList.concat(pick);
    });

    renderMiniQuestion();
}

function renderMiniQuestion() {
    if (miniIndex >= miniList.length) {
        showMiniResult();
        return;
    }

    const q = miniList[miniIndex];
    currentQuestion = q;
    displayQuestion(q);
}

// Mini Test ê²°ê³¼ ì¶œë ¥
function showMiniResult() {
    miniMode = false;

    let resultHTML = `<h2>Mini Test ì™„ë£Œ!</h2>`;
    resultHTML += `<p>ì´ ë¬¸ì œ: ${miniList.length}</p>`;
    resultHTML += `<p>ì •ë‹µ: ${miniList.length - miniWrong.length}</p>`;
    resultHTML += `<p>ì˜¤ë‹µ: ${miniWrong.length}</p><hr>`;

    if (miniWrong.length > 0) {
        resultHTML += `<h3>í‹€ë¦° ë¬¸ì œ ëª©ë¡:</h3>`;
        miniWrong.forEach(w => {
            resultHTML += `
            <div style="margin-bottom:10px;">
                <b>ë¬¸ì œ:</b> ${w.question}<br>
                <b>ë‹¹ì‹ ì˜ ë‹µ:</b> ${w.myAnswer}<br>
                <b>ì •ë‹µë“¤:</b> ${w.correct.join(", ")}
            </div>`;
        });
    }

    questionArea.innerHTML = resultHTML;
    answerBox.innerHTML = "";
}
</script>

</body>
</html>




