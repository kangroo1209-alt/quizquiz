<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>퀴즈 시스템</title>
<style>
body { font-family: Arial; margin: 20px; }
h1 { margin-bottom: 10px; }
select, button { padding: 8px; margin-right: 10px; }
#questionArea { margin-top: 20px; }
.question-card { border: 1px solid #ccc; padding: 10px; margin-bottom: 5px; cursor: pointer; }
.question-card:hover { background: #f0f0f0; }
.selected.correct { background: #d0f0d0; }
.selected.wrong { background: #f8d0d0; }
#answerBox { margin-top: 20px; padding: 10px; border: 1px solid #444; background: #fafafa; }
#nextBtn, #resetBtn { margin-top: 10px; padding: 8px 16px; }
#resetBtn { background:#e66; color:white; }
.correct { color: green; font-weight: bold; }
.wrong { color: red; font-weight: bold; }
#countBox { font-size: 15px; margin-top: 10px; font-weight: bold; }
</style>
</head>
<body>

<h1>퀴즈 시스템</h1>

<select id="subjectSelect">
    <option value="">과목 선택</option>
</select>

<select id="themeSelect">
    <option value="">테마 선택</option>
</select>

<div id="questionArea"></div>

<button id="nextBtn">다음 문제</button>
<button id="resetBtn">리셋</button>

<div id="countBox"></div>
<div id="answerBox"></div>

<script>
// ★ JSON 경로
const jsonURL = "https://kangroo1209-alt.github.io/quizquiz/output.json";

let quizData = [];
let currentSubject = "";
let currentTheme = "";
let currentAnswers = [];
let usedQuestions = [];

fetch(jsonURL)
.then(res => res.json())
.then(data => {
    quizData = data;
    renderSubjects();
});

const subjectSelect = document.getElementById("subjectSelect");
const themeSelect   = document.getElementById("themeSelect");
const questionArea  = document.getElementById("questionArea");
const answerBox     = document.getElementById("answerBox");
const nextBtn       = document.getElementById("nextBtn");
const resetBtn      = document.getElementById("resetBtn");
const countBox      = document.getElementById("countBox");

function renderSubjects() {
    const subjects = [...new Set(quizData.map(q => q.subject))];
    subjectSelect.innerHTML =
        '<option value="">과목 선택</option>' +
        subjects.map(s => `<option value="${s}">${s}</option>`).join("");
}

subjectSelect.addEventListener("change", () => {
    currentSubject = subjectSelect.value;
    renderThemes();
    usedQuestions = [];
    countBox.innerHTML = "";
    answerBox.innerHTML = "";
    questionArea.innerHTML = "";
});

function renderThemes() {
    const themes = [...new Set(
        quizData.filter(q => q.subject === currentSubject)
                .map(q => q.theme)
    )];

    themeSelect.innerHTML =
        '<option value="">테마 선택</option>' +
        themes.map(t => `<option value="${t}">${t}</option>`).join("");
}

themeSelect.addEventListener("change", () => {
    currentTheme = themeSelect.value;
    usedQuestions = [];
    answerBox.innerHTML = "";
    countBox.innerHTML = "";
    renderQuestion();
});

function updateCountBox(totalCount) {
    const solved = usedQuestions.length;
    countBox.innerHTML = `전체 ${totalCount}문제 중 ${solved}문제 풀이`;
}

// ----------------------
// 문제 랜덤 생성 (중복 방지 + 보기 5개 확보)
// ----------------------
function renderQuestion() {

    if (!currentSubject || !currentTheme) {
        questionArea.innerHTML = "<p>과목과 테마를 선택하세요.</p>";
        return;
    }

    let filtered = quizData.filter(
        q => q.subject === currentSubject && q.theme === currentTheme
    );

    const totalCount = filtered.length;

    filtered = filtered.filter(q => !usedQuestions.includes(q.question));

    if (filtered.length === 0) {
        questionArea.innerHTML = "<p>모든 문제를 다 풀었습니다.</p>";
        updateCountBox(totalCount);
        return;
    }

    const randIndex = Math.floor(Math.random() * filtered.length);
    const problem = filtered[randIndex];
    usedQuestions.push(problem.question);

    // 정답 배열 (콤마로 구분된 다중 정답)
    currentAnswers = problem.answer
        .split(',')
        .map(a => a.trim())
        .filter(a => a.length > 0);

    // ----------------------
    // 보기 5개 확보 로직
    // ----------------------
    let answers = [...currentAnswers];

    // 1️⃣ 같은 테마 후보
    let candidates = quizData
        .filter(q => q.subject === currentSubject && q.theme === currentTheme)
        .map(q => q.answer)
        .filter(a => !answers.includes(a));
    candidates = [...new Set(candidates)];

    while (answers.length < 5 && candidates.length > 0) {
        const rand = Math.floor(Math.random() * candidates.length);
        answers.push(candidates.splice(rand, 1)[0]);
    }

    // 2️⃣ 다른 테마 후보
    if (answers.length < 5) {
        let otherCandidates = quizData
            .filter(q => q.subject === currentSubject && q.theme !== currentTheme)
            .map(q => q.answer)
            .filter(a => !answers.includes(a));
        otherCandidates = [...new Set(otherCandidates)];

        while (answers.length < 5 && otherCandidates.length > 0) {
            const rand = Math.floor(Math.random() * otherCandidates.length);
            answers.push(otherCandidates.splice(rand, 1)[0]);
        }
    }

    // 3️⃣ 그래도 부족하면 빈 보기 추가
    while (answers.length < 5) {
        answers.push("보기 없음");
    }

    answers.sort(() => Math.random() - 0.5);

    // 화면 출력
    questionArea.innerHTML = `<div class="question-card"><b>문제:</b> ${problem.question}</div>`;
    answers.forEach((ans, i) => {
        questionArea.innerHTML += `
            <div class="question-card" onclick="checkAnswer('${ans.replace(/'/g,"&#39;")}', event)">
                ${i+1}. ${ans}
            </div>
        `;
    });

    updateCountBox(totalCount);
    answerBox.innerHTML = "";
}

// ----------------------
// 정답 체크 (다중 정답 모두 표시)
// ----------------------
window.checkAnswer = function(selected, event) {
    if (answerBox.innerHTML) return; // 이미 선택했으면 무시

    // 선택 카드 강조
    document.querySelectorAll('.question-card').forEach(card => card.classList.remove('selected','correct','wrong'));
    event.currentTarget.classList.add('selected', currentAnswers.includes(selected) ? 'correct':'wrong');

    // 정답/오답 + 전체 정답 표시
    if (currentAnswers.includes(selected)) {
        answerBox.innerHTML = `
            <p class="correct">정답입니다!</p>
            <p>정답 목록: ${currentAnswers.join(", ")}</p>
        `;
    } else {
        answerBox.innerHTML = `
            <p class="wrong">오답!</p>
            <p>정답 목록: ${currentAnswers.join(", ")}</p>
        `;
    }
};

// ----------------------
// 다음 문제
// ----------------------
nextBtn.addEventListener("click", renderQuestion);

// ----------------------
// 리셋 기능
// ----------------------
resetBtn.addEventListener("click", () => {
    usedQuestions = [];
    countBox.innerHTML = "문제 기록이 초기화되었습니다.";
    answerBox.innerHTML = "";
    questionArea.innerHTML = "";
});
</script>

</body>
</html>


