<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>í€´ì¦ˆ ì‹œìŠ¤í…œ</title>
<style>
body { font-family: Arial; margin: 20px; }
h1 { margin-bottom: 10px; }
select, button { padding: 8px; margin-right: 10px; }
#questionArea { margin-top: 20px; }
.question-card { 
    border: 1px solid #ccc; 
    padding: 10px; 
    margin-bottom: 5px; 
    cursor: pointer; 
    background: white;
    transition: 0.15s;
}
.question-card:hover { background: #f0f0f0; }

#answerBox { 
    margin-top: 20px; 
    padding: 10px; 
    border: 1px solid #444; 
    background: #fafafa; 
}

#nextBtn { margin-top: 10px; padding: 8px 16px; }

.correct { color: green; font-weight: bold; }
.wrong { color: red; font-weight: bold; }

#statusBar { 
    margin-top: 10px; 
    font-weight: bold; 
}

.menuBar { 
    margin-top: 15px;
    margin-bottom: 10px;
}

/* ğŸ”¥ ë¹¨ê°„ìƒ‰ RESET ë²„íŠ¼ */
#resetBtn {
    padding: 6px 12px;
    margin-right: 12px;
    background-color: #ff4d4d;
    color: white;
    border: none;
    border-radius: 6px;
    font-weight: bold;
    cursor: pointer;
}
#resetBtn:hover {
    background-color: #e60000;
}

/* Mini Test ëª¨ë“œ ë°°ê²½ */
.mini-mode .question-card,
.mini-mode #answerBox {
    background: #FFF9D9 !important;
}

/* ì£¼ê´€ì‹ ì…ë ¥ì°½ */
#textAnswerBox {
    width: 300px;
    padding: 8px;
    margin-top: 10px;
}

#submitBtn {
    padding: 6px 12px;
    margin-left: 8px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
}
#submitBtn:hover {
    background-color: #3d8f40;
}

#stopMiniBtn {
    padding: 6px 12px;
    background: #ffb84d;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    margin-bottom: 10px;
}
</style>
</head>
<body>

<h1>í€´ì¦ˆ ì‹œìŠ¤í…œ</h1>

<select id="subjectSelect">
    <option value="">ê³¼ëª© ì„ íƒ</option>
</select>

<select id="themeSelect">
    <option value="">í…Œë§ˆ ì„ íƒ</option>
</select>

<div class="menuBar">
    <button id="resetBtn" style="display:none;">ğŸ”„ ë¦¬ì…‹</button>
    <button id="miniTestBtn">ğŸ”¥ Mini Test (ê³¼ëª©ë³„ 10ë¬¸ì œ)</button>
    <button id="stopMiniBtn" style="display:none;">ì—¬ê¸°ê¹Œì§€ë§Œ í’€ê¸° ã…œã…œ</button>
</div>

<div id="statusBar"></div>

<div id="questionArea"></div>

<button id="nextBtn">ë‹¤ìŒ ë¬¸ì œ</button>

<div id="answerBox"></div>

<script>
const jsonURL = "https://kangroo1209-alt.github.io/quizquiz/output.json";

let quizData = [];
let currentSubject = "";
let currentTheme = "";
let currentQuestion = null;
let usedQuestions = new Set();

let solvedCount = 0;
let totalCount = 0;

// ë¯¸ë‹ˆ í…ŒìŠ¤íŠ¸
let miniMode = false;
let miniList = [];
let miniIndex = 0;
let miniWrong = [];
let miniTotal = 0;

// UI ìš”ì†Œ
const subjectSelect = document.getElementById("subjectSelect");
const themeSelect = document.getElementById("themeSelect");
const questionArea = document.getElementById("questionArea");
const answerBox = document.getElementById("answerBox");
const nextBtn = document.getElementById("nextBtn");
const miniTestBtn = document.getElementById("miniTestBtn");
const resetBtn = document.getElementById("resetBtn");
const statusBar = document.getElementById("statusBar");
const stopMiniBtn = document.getElementById("stopMiniBtn");

fetch(jsonURL)
.then(res => res.json())
.then(data => {
    quizData = data;
    renderSubjects();
});

function applyMiniModeUI(active) {
    if (active) {
        document.body.classList.add("mini-mode");
    } else {
        document.body.classList.remove("mini-mode");
    }
}

function renderSubjects() {
    const subjects = [...new Set(quizData.map(q => q.subject))];
    subjectSelect.innerHTML =
        '<option value="">ê³¼ëª© ì„ íƒ</option>' +
        subjects.map(s => `<option value="${s}">${s}</option>`).join("");
}

subjectSelect.addEventListener("change", () => {
    currentSubject = subjectSelect.value;
    renderThemes();
    resetNormalMode();
});

function renderThemes() {
    const themes = [...new Set(
        quizData.filter(q => q.subject === currentSubject).map(q => q.theme)
    )];
    themeSelect.innerHTML =
        '<option value="">í…Œë§ˆ ì„ íƒ</option>' +
        themes.map(t => `<option value="${t}">${t}</option>`).join("");
}

themeSelect.addEventListener("change", () => {
    currentTheme = themeSelect.value;
    miniMode = false;
    applyMiniModeUI(false);
    stopMiniBtn.style.display = "none";
    resetNormalMode();
    renderQuestion();
});
<!-- -------------------- ê³µí†µ ìœ í‹¸ -------------------- -->

<script>
function normalizeAnswer(x) {
    if (x === undefined || x === null) return "";

    // ë¬¸ìì—´ ë³€í™˜ + ì „ê° ê³µë°± ì œê±° + trim
    x = String(x).replace(/\u3000/g, "").trim();

    // ìˆ«ìë©´ ìˆ«ìë¡œ í†µì¼ ("03"â†’3, "3.0"â†’3)
    if (!isNaN(x)) return Number(x).toString();

    return x;
}

function getCorrectAnswers(questionText) {
    return [...new Set(
        quizData.filter(q => q.question === questionText).map(q => q.answer)
    )];
}

function updateStatusBar() {
    if (miniMode) {
        const sub = miniList[miniIndex]
            ? miniList[miniIndex].subject
            : "";

        statusBar.innerHTML =
            `ğŸ”¥ Mini Test ì§„í–‰ ì¤‘<br>
             ğŸ“˜ í˜„ì¬ ê³¼ëª©: ${sub}<br>
             â³ ${miniIndex} / ${miniTotal} ë¬¸ì œ ì™„ë£Œ`;
        return;
    }

    if (currentSubject && currentTheme) {
        statusBar.innerHTML =
            `ğŸ“˜ ${currentSubject} / ${currentTheme}<br>
             ğŸ” ${solvedCount}ë¬¸ì œ í’€ìŒ / ${totalCount}ë¬¸ì œ ì¤‘`;
    } else {
        statusBar.innerHTML = "";
    }
}

/* -------------------- ë¦¬ì…‹ -------------------- */
function resetNormalMode() {
    usedQuestions.clear();
    solvedCount = 0;

    const filtered = quizData.filter(
        q => q.subject === currentSubject && q.theme === currentTheme
    );
    totalCount = filtered.length;

    updateStatusBar();
    questionArea.innerHTML = "";
    answerBox.innerHTML = "";
    resetBtn.style.display = (currentSubject && currentTheme) ? "inline-block" : "none";
}

resetBtn.addEventListener("click", resetNormalMode);


/* -------------------- ë¬¸ì œ ì¶œì œ -------------------- */

function renderQuestion() {
    if (!currentSubject || !currentTheme) {
        questionArea.innerHTML = "<p>ê³¼ëª©ê³¼ í…Œë§ˆë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>";
        return;
    }

    const filtered = quizData.filter(
        q => q.subject === currentSubject && q.theme === currentTheme
    );

    const remaining = filtered.filter(q => !usedQuestions.has(q.question));

    if (remaining.length === 0) {
        questionArea.innerHTML = "<p>ğŸ‰ ëª¨ë“  ë¬¸ì œë¥¼ ë‹¤ í’€ì—ˆìŠµë‹ˆë‹¤!</p>";
        return;
    }

    const q = remaining[Math.floor(Math.random() * remaining.length)];
    currentQuestion = q;
    usedQuestions.add(q.question);

    solvedCount++;
    updateStatusBar();

    renderQuestionCard(q);
}

function renderQuestionCard(q) {
    const correctAnswers = getCorrectAnswers(q.question);
    const mainAnswer = correctAnswers[0];

    questionArea.innerHTML = `<div class="question-card"><b>ë¬¸ì œ:</b> ${q.question}</div>`;
    answerBox.innerHTML = "";

    /* ---------- ê³„ì‚° í…Œë§ˆ â†’ ì£¼ê´€ì‹ ëª¨ë“œ ---------- */
    if (q.theme === "ê³„ì‚°") {
        questionArea.innerHTML += `
            <input id="textAnswerBox" placeholder="ì •ë‹µ ì…ë ¥">
            <button id="submitBtn">ì œì¶œ</button>
        `;

        nextBtn.style.display = miniMode ? "none" : "inline-block";

        setTimeout(() => {
            document.getElementById("submitBtn").onclick = () => {
                const userRaw = document.getElementById("textAnswerBox").value;
                const user = normalizeAnswer(userRaw);

                const normCorrect = correctAnswers.map(a => normalizeAnswer(a));

                if (normCorrect.includes(user)) {
                    answerBox.innerHTML =
                        `<p class="correct">ì •ë‹µì…ë‹ˆë‹¤!</p>
                         <p>ë‹¤ë¥¸ ì •ë‹µë“¤: ${correctAnswers.join(", ")}</p>`;
                    handleMiniProgress(true);
                } else {
                    answerBox.innerHTML =
                        `<p class="wrong">ì˜¤ë‹µì…ë‹ˆë‹¤!</p>
                         <p>ì •ë‹µ: ${correctAnswers[0]}</p>
                         <p>ë‹¤ë¥¸ ì •ë‹µë“¤: ${correctAnswers.join(", ")}</p>`;
                    handleMiniProgress(false);
                }
            };
        }, 50);

        return;
    }

    /* ---------- ë³´ê¸° 5ì§€ì„ ë‹¤ ---------- */

    let answers = [mainAnswer];

    const sameTheme = quizData.filter(
        item => item.subject === q.subject && item.theme === q.theme
    );

    let otherAnswers = sameTheme
        .map(item => item.answer)
        .filter(a => !correctAnswers.includes(a));

    while (answers.length < 5 && otherAnswers.length > 0) {
        const i = Math.floor(Math.random() * otherAnswers.length);
        answers.push(otherAnswers[i]);
        otherAnswers.splice(i, 1);
    }

    answers = answers.sort(() => Math.random() - 0.5);

    answers.forEach((ans, i) => {
        questionArea.innerHTML += `
            <div class="question-card" onclick="checkAnswer('${ans.replace(/'/g,"&#39;")}')">
                ${i + 1}. ${ans}
            </div>
        `;
    });

    nextBtn.style.display = miniMode ? "none" : "inline-block";
}


/* -------------------- ê°ê´€ì‹ ì •ë‹µ ì²´í¬ -------------------- */

window.checkAnswer = (ans) => {
    const correct = getCorrectAnswers(currentQuestion.question);
    const mainAnswer = correct[0];

    if (ans === mainAnswer) {
        answerBox.innerHTML =
            `<p class="correct">ì •ë‹µì…ë‹ˆë‹¤!</p>
             <p>ë‹¤ë¥¸ ì •ë‹µë“¤: ${correct.join(", ")}</p>`;
        handleMiniProgress(true);
    } else {
        answerBox.innerHTML =
            `<p class="wrong">ì˜¤ë‹µì…ë‹ˆë‹¤!</p>
             <p>ì •ë‹µ: ${mainAnswer}</p>
             <p>ë‹¤ë¥¸ ì •ë‹µë“¤: ${correct.join(", ")}</p>`;
        handleMiniProgress(false);
    }
};


/* -------------------- ë‹¤ìŒ ë¬¸ì œ -------------------- */

nextBtn.addEventListener("click", () => {
    if (!miniMode) renderQuestion();
});


/* -------------------- Mini Test -------------------- */

miniTestBtn.addEventListener("click", startMiniTest);

function startMiniTest() {
    miniMode = true;
    applyMiniModeUI(true);
    stopMiniBtn.style.display = "inline-block";
    nextBtn.style.display = "none";

    usedQuestions.clear();
    miniWrong = [];
    miniIndex = 0;

    const subjects = [...new Set(quizData.map(q => q.subject))];
    miniList = [];

    subjects.forEach(sub => {
        const pool = quizData.filter(q => q.subject === sub);
        const pick = [];

        while (pick.length < 10 && pool.length > 0) {
            const i = Math.floor(Math.random() * pool.length);
            pick.push(pool[i]);
            pool.splice(i, 1);
        }

        miniList = miniList.concat(pick);
    });

    miniTotal = miniList.length;

    updateStatusBar();
    renderMiniQuestion();
}


function renderMiniQuestion() {
    if (miniIndex >= miniTotal) {
        showMiniResult();
        return;
    }

    const q = miniList[miniIndex];
    currentQuestion = q;

    renderQuestionCard(q);
    updateStatusBar();
}


/* ---------- ë¯¸ë‹ˆí…ŒìŠ¤íŠ¸: ì •ë‹µì²˜ë¦¬ ---------- */

function handleMiniProgress(isCorrect) {
    if (miniMode) {
        if (!isCorrect) {
            miniWrong.push({
                question: currentQuestion.question,
                myAnswer: "",
                correct: getCorrectAnswers(currentQuestion.question)
            });
        }
        miniIndex++;
        setTimeout(renderMiniQuestion, 500);
    }
}


/* ---------- ì—¬ê¸°ê¹Œì§€ë§Œ í’€ê¸° ã…œã…œ ---------- */

stopMiniBtn.addEventListener("click", showMiniResult);


/* -------------------- Mini Test ê²°ê³¼ -------------------- */

function showMiniResult() {
    miniMode = false;
    applyMiniModeUI(false);
    stopMiniBtn.style.display = "none";
    nextBtn.style.display = "inline-block";

    let html = `<h2>Mini Test ì™„ë£Œ!</h2>`;
    html += `<p>ì´ ë¬¸ì œ: ${miniIndex}</p>`;
    html += `<p>ì •ë‹µ: ${miniIndex - miniWrong.length}</p>`;
    html += `<p>ì˜¤ë‹µ: ${miniWrong.length}</p>`;

    if (miniWrong.length > 0) {
        html += `<h3>í‹€ë¦° ë¬¸ì œë“¤</h3>`;
        miniWrong.forEach(w => {
            html += `
                <p><b>${w.question}</b><br>
                ì •ë‹µ: ${w.correct.join(", ")}</p><hr>
            `;
        });
    }

    questionArea.innerHTML = html;
    answerBox.innerHTML = "";
    statusBar.innerHTML = "";
}
</script>

</body>
</html>









